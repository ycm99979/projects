<?xml version="1.0"?>
<robot name="mobile_base" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:include filename="../inertial_macros.xacro"/>

    <!-- ==================== PROPERTIES ==================== -->
    <xacro:property name="meshes_file_direction" value="file://$(find robot_description)/meshes"/>

    <!-- ==================== MATERIALS ==================== -->
    <material name="dark_grey">
        <color rgba="0.2 0.2 0.2 1.0"/>
    </material>
    <material name="light_grey">
        <color rgba="0.4 0.4 0.4 1.0"/>
    </material>
    <material name="black">
        <color rgba="0.15 0.15 0.15 1.0"/>
    </material>

    <!-- ==================== MOBILE BASE ==================== -->
    <link name="base_link"/>

    <joint name="base_link_joint" type="fixed">
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <parent link="base_link"/>
        <child link="chassis_link"/>
    </joint>

    <link name="chassis_link">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="${meshes_file_direction}/robot_chassis.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
        <collision>
            <origin xyz="0 0 0.085" rpy="0 0 0"/>
            <geometry>
                <box size="0.60 0.46 0.235"/>
            </geometry>
        </collision>
        <inertial>
            <origin rpy="0 0 0" xyz="0.012 0.002 0.067"/>
            <mass value="16.523"/>
            <inertia ixx="0.3136" ixy="-0.0008" ixz="0.0164" iyy="0.3922" iyz="-0.0009" izz="0.4485"/>
        </inertial>
    </link>

    <!-- ==================== WHEELS ==================== -->
    <!-- Front Left Wheel -->
    <link name="front_left_wheel_link">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="${meshes_file_direction}/left_wheel.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="black"/>
        </visual>
        <collision>
            <origin rpy="1.5708 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.04" radius="0.098"/>
            </geometry>
        </collision>
        <inertial>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <mass value="0.477"/>
            <inertia ixx="0.0013" ixy="0" ixz="0" iyy="0.0024" iyz="0" izz="0.0013"/>
        </inertial>
    </link>

    <joint name="front_left_wheel_joint" type="continuous">
        <parent link="chassis_link"/>
        <child link="front_left_wheel_link"/>
        <origin rpy="0 0 0" xyz="0.220 0.160 0.033"/>
        <axis xyz="0 1 0"/>
    </joint>

    <!-- Front Right Wheel -->
    <link name="front_right_wheel_link">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="${meshes_file_direction}/right_wheel.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="black"/>
        </visual>
        <collision>
            <origin rpy="1.5708 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.04" radius="0.098"/>
            </geometry>
        </collision>
        <inertial>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <mass value="0.477"/>
            <inertia ixx="0.0013" ixy="0" ixz="0" iyy="0.0024" iyz="0" izz="0.0013"/>
        </inertial>
    </link>

    <joint name="front_right_wheel_joint" type="continuous">
        <parent link="chassis_link"/>
        <child link="front_right_wheel_link"/>
        <origin rpy="0 0 0" xyz="0.220 -0.160 0.033"/>
        <axis xyz="0 1 0"/>
    </joint>

    <!-- Rear Left Wheel -->
    <link name="rear_left_wheel_link">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="${meshes_file_direction}/left_wheel.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="black"/>
        </visual>
        <collision>
            <origin rpy="1.5708 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.04" radius="0.098"/>
            </geometry>
        </collision>
        <inertial>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <mass value="0.477"/>
            <inertia ixx="0.0013" ixy="0" ixz="0" iyy="0.0024" iyz="0" izz="0.0013"/>
        </inertial>
    </link>

    <joint name="rear_left_wheel_joint" type="continuous">
        <parent link="chassis_link"/>
        <child link="rear_left_wheel_link"/>
        <origin rpy="0 0 0" xyz="-0.220 0.160 0.033"/>
        <axis xyz="0 1 0"/>
    </joint>

    <!-- Rear Right Wheel -->
    <link name="rear_right_wheel_link">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="${meshes_file_direction}/right_wheel.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="black"/>
        </visual>
        <collision>
            <origin rpy="1.5708 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.04" radius="0.098"/>
            </geometry>
        </collision>
        <inertial>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <mass value="0.477"/>
            <inertia ixx="0.0013" ixy="0" ixz="0" iyy="0.0024" iyz="0" izz="0.0013"/>
        </inertial>
    </link>

    <joint name="rear_right_wheel_joint" type="continuous">
        <parent link="chassis_link"/>
        <child link="rear_right_wheel_link"/>
        <origin rpy="0 0 0" xyz="-0.220 -0.160 0.033"/>
        <axis xyz="0 1 0"/>
    </joint>

    <!-- ==================== SENSORS ==================== -->
    <!-- IMU -->
    <joint name="imu_joint" type="fixed">
        <parent link="chassis_link"/>
        <child link="imu_link"/>
        <origin xyz="0.300 0 0.215" rpy="0 0 0"/>
    </joint>

    <link name="imu_link"/>

    <!-- Camera -->
    <joint name="camera_joint" type="fixed">
        <parent link="chassis_link"/>
        <child link="camera_link"/>
        <origin xyz="0.300 0 0.215" rpy="0 0 0"/>
    </joint>

    <link name="camera_link">
        <visual>
            <geometry>
                <mesh filename="${meshes_file_direction}/D455.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="light_grey"/>
        </visual>
        <collision>
            <geometry>
                <mesh filename="${meshes_file_direction}/D455.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>

    <joint name="camera_sensor_joint" type="fixed">
        <parent link="camera_link"/>
        <child link="camera_sensor_link"/>
        <origin xyz="0.03 0 0" rpy="0 0 0"/>
    </joint>

    <link name="camera_sensor_link"/>

    <!-- LiDAR -->
    <joint name="lidar_mount_joint" type="fixed">
        <parent link="chassis_link"/>
        <child link="lidar_mount"/>
        <origin xyz="-0.150 0 0.235" rpy="0 0 0"/>
    </joint>

    <link name="lidar_mount">
        <visual>
            <geometry>
                <mesh filename="${meshes_file_direction}/lidar_mount.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="dark_grey"/>
        </visual>
        <collision>
            <geometry>
                <mesh filename="${meshes_file_direction}/lidar_mount.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
    </link>

    <link name="VLP16">
        <visual>
            <geometry>
                <mesh filename="${meshes_file_direction}/VLP16.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="light_grey"/>
        </visual>
        <collision>
            <geometry>
                <mesh filename="${meshes_file_direction}/VLP16.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="0.83"/>
            <origin xyz="0 0 0.03585"/>
            <inertia ixx="0.0009" ixy="0" ixz="0" iyy="0.0009" iyz="0" izz="0.0011"/>
        </inertial>
    </link>

    <joint name="lidar_to_lidar_mount" type="fixed">
        <parent link="lidar_mount"/>
        <child link="VLP16"/>
        <origin xyz="0 0 0.160" rpy="0 0 0"/>
    </joint>

</robot>