<?xml version="1.0"?>
<!--
============================================================================
Mobile Manipulator ros2_control - Real Hardware
============================================================================

실제 하드웨어용 ros2_control 설정
- 팔: MyActuator RMD 모터 4개 (CAN 통신)
- 그리퍼: 추후 추가 예정
- 휠: 별도 하드웨어 인터페이스 (옵션)

[사용법]
<xacro:include filename="$(find robot_description)/urdf/ros2_control_hardware.urdf.xacro"/>
<xacro:ros2_control_hardware can_interface="can0"/>

============================================================================
-->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:macro name="ros2_control_hardware" params="
    can_interface:=can0
    motor1_id:=1
    motor2_id:=2
    motor3_id:=3
    motor4_id:=4
    auto_home:=true
  ">

    <ros2_control name="arm_hardware_system" type="system">
      <hardware>
        <plugin>myactuator_hardware/MultiMotorHardwareInterface</plugin>
        <param name="ifname">${can_interface}</param>
        <param name="auto_home">${auto_home}</param>
        <param name="cycle_time">20</param>  <!-- 20ms 주기로 설정 (50Hz) -->
        <param name="timeout">1000</param>   <!-- 1초 타임아웃 -->
      </hardware>

      <!-- Joint 1: link2_to_link1 (base rotation) -->
      <joint name="link2_to_link1">
        <param name="actuator_id">${motor1_id}</param>
        <param name="torque_constant">0.32</param>
        <command_interface name="position"/>
        <command_interface name="velocity"/>
        <command_interface name="effort"/>
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity"/>
        <state_interface name="effort"/>
      </joint>

      <!-- Joint 2: link3_to_link2 (shoulder) -->
      <joint name="link3_to_link2">
        <param name="actuator_id">${motor2_id}</param>
        <param name="torque_constant">0.32</param>
        <command_interface name="position"/>
        <command_interface name="velocity"/>
        <command_interface name="effort"/>
        <state_interface name="position">
          <param name="initial_value">-0.5</param>
        </state_interface>
        <state_interface name="velocity"/>
        <state_interface name="effort"/>
      </joint>

      <!-- Joint 3: link4_to_link3 (elbow) -->
      <joint name="link4_to_link3">
        <param name="actuator_id">${motor3_id}</param>
        <param name="torque_constant">0.32</param>
        <command_interface name="position"/>
        <command_interface name="velocity"/>
        <command_interface name="effort"/>
        <state_interface name="position">
          <param name="initial_value">0.8</param>
        </state_interface>
        <state_interface name="velocity"/>
        <state_interface name="effort"/>
      </joint>

      <!-- Joint 4: gripper_to_link4 (wrist) -->
      <joint name="gripper_to_link4">
        <param name="actuator_id">${motor4_id}</param>
        <param name="torque_constant">0.32</param>
        <command_interface name="position"/>
        <command_interface name="velocity"/>
        <command_interface name="effort"/>
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity"/>
        <state_interface name="effort"/>
      </joint>
    </ros2_control>

    <!-- Gripper - fake hardware for now (추후 실제 하드웨어로 교체) -->
    <ros2_control name="gripper_hardware_system" type="system">
      <hardware>
        <plugin>mock_components/GenericSystem</plugin>
      </hardware>
      <joint name="gripper_left_joint">
        <command_interface name="position"/>
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity"/>
      </joint>
      <joint name="gripper_right_joint">
        <command_interface name="position"/>
        <state_interface name="position">
          <param name="initial_value">0.0</param>
        </state_interface>
        <state_interface name="velocity"/>
      </joint>
    </ros2_control>

    <!-- Wheels - fake hardware for now (MoveIt에서는 사용 안 함) -->
    <ros2_control name="wheel_hardware_system" type="system">
      <hardware>
        <plugin>mock_components/GenericSystem</plugin>
      </hardware>
      <joint name="front_left_wheel_joint">
        <command_interface name="velocity"/>
        <state_interface name="position"/>
        <state_interface name="velocity"/>
      </joint>
      <joint name="front_right_wheel_joint">
        <command_interface name="velocity"/>
        <state_interface name="position"/>
        <state_interface name="velocity"/>
      </joint>
      <joint name="rear_left_wheel_joint">
        <command_interface name="velocity"/>
        <state_interface name="position"/>
        <state_interface name="velocity"/>
      </joint>
      <joint name="rear_right_wheel_joint">
        <command_interface name="velocity"/>
        <state_interface name="position"/>
        <state_interface name="velocity"/>
      </joint>
    </ros2_control>

  </xacro:macro>

</robot>
