# MD Motor Hardware Interface for ros2_control

MD ë“€ì–¼ì±„ë„ ëª¨í„° ë“œë¼ì´ë²„ë¥¼ ros2_control Hardware Interfaceë¡œ êµ¬í˜„í•œ íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤.

---

## ğŸ“ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ROS 2 Application Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ teleop_keyboard  â”‚    â”‚   Navigation2      â”‚    â”‚     Your Node           â”‚  â”‚
â”‚  â”‚ /cmd_vel         â”‚    â”‚   /cmd_vel         â”‚    â”‚     /cmd_vel            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                        â”‚                           â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                    â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Controller Manager                                â”‚   â”‚
â”‚  â”‚                    (ros2_control_node, 50Hz)                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚   diff_drive_controller    â”‚  â”‚   joint_state_broadcaster          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ cmd_vel â†’ wheel vel    â”‚  â”‚   â€¢ joint_states í† í”½ ë°œí–‰         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ wheel_separation       â”‚  â”‚   â€¢ position, velocity ìƒíƒœ       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ wheel_radius           â”‚  â”‚                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ odom ë°œí–‰              â”‚  â”‚                                    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚             â”‚ velocity commands                    â”‚ state feedback      â”‚   â”‚
â”‚  â”‚             â–¼                                      â–¼                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚         Command Interface        â”‚       State Interface        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚   hw_commands_[0] (left vel)     â”‚   hw_positions_[0], [1]      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚   hw_commands_[1] (right vel)    â”‚   hw_velocities_[0], [1]     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MDMotorHardware (Hardware Interface)                      â”‚
â”‚                              src/md_hardware.cpp                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          Lifecycle ìƒíƒœ ê´€ë¦¬                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ on_init  â”‚ â†’  â”‚ on_configure â”‚ â†’  â”‚ on_activateâ”‚ â†’  â”‚on_deactivate   â”‚   â”‚
â”‚  â”‚  â”‚ íŒŒë¼ë¯¸í„° â”‚    â”‚ ì‹œë¦¬ì–¼ ì—´ê¸°  â”‚    â”‚ ëª¨í„° í™œì„±í™”â”‚    â”‚ ëª¨í„° ì •ì§€  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ë¡œë“œ     â”‚    â”‚ initSerial() â”‚    â”‚            â”‚    â”‚ í† í¬ OFF   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        write() (50Hz)          â”‚    â”‚          read() (50Hz)             â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚   â”‚
â”‚  â”‚  1. rad/s â†’ RPM ë³€í™˜           â”‚    â”‚  1. ì‹œë¦¬ì–¼ ë°ì´í„° ìˆ˜ì‹              â”‚   â”‚
â”‚  â”‚  2. putMdData() í˜¸ì¶œ           â”‚    â”‚  2. receiveDataFromController()   â”‚   â”‚
â”‚  â”‚  3. íŒ¨í‚· ìƒì„± & ì „ì†¡           â”‚    â”‚  3. analyzeReceivedData()         â”‚   â”‚
â”‚  â”‚                                â”‚    â”‚  4. processReceivedData()         â”‚   â”‚
â”‚  â”‚  hw_commands_[] â†’              â”‚    â”‚  5. RPM/Position ì¶”ì¶œ             â”‚   â”‚
â”‚  â”‚    â†’ RPM ë³€í™˜ â†’                â”‚    â”‚     â†’ hw_velocities_[]            â”‚   â”‚
â”‚  â”‚      â†’ ì‹œë¦¬ì–¼ TX               â”‚    â”‚     â†’ hw_positions_[]             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                    â–²                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                                    â”‚
                     â–¼                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Serial Communication Layer                             â”‚
â”‚                              (libserial ë¼ì´ë¸ŒëŸ¬ë¦¬)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  serial::Serial serial_;                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Port: /dev/ttyUSB0 (ë˜ëŠ” /dev/ttyMotor)                               â”‚   â”‚
â”‚  â”‚  â€¢ Baudrate: 19200                                                        â”‚   â”‚
â”‚  â”‚  â€¢ Timeout: 100ms                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                                    â–²                       â”‚
â”‚                     â”‚ TX (ì†¡ì‹ )                         â”‚ RX (ìˆ˜ì‹ )              â”‚
â”‚                     â–¼                                    â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                                    â”‚
                      â”‚         RS-485 / USB-Serial        â”‚
                      â–¼                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MD Motor Driver (BLDC)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     ë“€ì–¼ ì±„ë„ ëª¨í„° ë“œë¼ì´ë²„                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚   Channel 1 (Left)      â”‚    â”‚   Channel 2 (Right)     â”‚              â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ RPM ì œì–´            â”‚    â”‚   â€¢ RPM ì œì–´            â”‚              â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Hall ì„¼ì„œ í”¼ë“œë°±    â”‚    â”‚   â€¢ Hall ì„¼ì„œ í”¼ë“œë°±    â”‚              â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Position ì¹´ìš´íŠ¸     â”‚    â”‚   â€¢ Position ì¹´ìš´íŠ¸     â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚              â”‚                              â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â–¼                              â–¼                                 â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚        â”‚  Left Motor   â”‚              â”‚  Right Motor  â”‚                         â”‚
â”‚        â”‚   (BLDC)      â”‚              â”‚   (BLDC)      â”‚                         â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ í†µì‹  í”„ë¡œí† ì½œ ìƒì„¸

### TX íŒ¨í‚· êµ¬ì¡° (PC â†’ ëª¨í„° ë“œë¼ì´ë²„)

#### PID_PNT_VEL_CMD (207) - ë“€ì–¼ ëª¨í„° ì†ë„ ëª…ë ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚Byte 0â”‚Byte 1â”‚Byte 2â”‚Byte 3â”‚Byte 4â”‚Byte 5â”‚Byte 6â”‚Byte 7â”‚Byte 8â”‚Byte 9â”‚Byte10â”‚Byte11â”‚Byte12â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ RMID â”‚ TMID â”‚  ID  â”‚ PID  â”‚ Size â”‚D1_EN â”‚D1_RPMâ”‚D1_RPMâ”‚D2_EN â”‚D2_RPMâ”‚D2_RPMâ”‚  REQ â”‚ CHK  â”‚
â”‚ 183  â”‚ 184  â”‚  1   â”‚ 207  â”‚   7  â”‚   1  â”‚  Low â”‚ High â”‚   1  â”‚  Low â”‚ High â”‚   2  â”‚ ~sum â”‚
â”‚(MDT) â”‚(MDUI)â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚      â”‚  +1  â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚                    â”‚
         â”‚                           â”‚                    â””â”€â”€ REQUEST_PNT_MAIN_DATA (2)
         â”‚                           â”‚                        í”¼ë“œë°± ë°ì´í„° ìš”ì²­
         â”‚                           â”‚
         â”‚                           â””â”€â”€ D1/D2 RPM: int16_t (Little Endian)
         â”‚                               ì–‘ìˆ˜: ì •ë°©í–¥, ìŒìˆ˜: ì—­ë°©í–¥
         â”‚
         â””â”€â”€ TMID: PC ì‹ë³„ì (184)
             RMID: ëª¨í„° ë“œë¼ì´ë²„ ì‹ë³„ì (183)
```

### RX íŒ¨í‚· êµ¬ì¡° (ëª¨í„° ë“œë¼ì´ë²„ â†’ PC)

#### PID_MAIN_DATA (193) - í”¼ë“œë°± ë°ì´í„°

```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Byte 0â”‚Byte 1â”‚Byte 2â”‚Byte 3â”‚Byte 4â”‚           Data (ê°€ë³€ ê¸¸ì´)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RMID â”‚ TMID â”‚  ID  â”‚ PID  â”‚ Size â”‚ [RPM_L][RPM_H][POS0][POS1][POS2][POS3]...      â”‚
â”‚ 184  â”‚ 183  â”‚  1   â”‚ 193  â”‚  16+ â”‚      Left Motor Data    â”‚   Right Motor Data  â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Data ìƒì„¸:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Left Motor (Byte 5~)       â”‚        Right Motor (Byte 13~)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [0-1] RPM (int16)                  â”‚ [8-9]  RPM (int16)                 â”‚
â”‚ [2-5] Position (int32)             â”‚ [10-13] Position (int32)           â”‚
â”‚ [6-7] Current (int16)              â”‚ [14-15] Current (int16)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ë°ì´í„° íë¦„ ìƒì„¸

### 1. ëª…ë ¹ ì „ì†¡ (write)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            write() í•¨ìˆ˜ ì‹¤í–‰ íë¦„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   diff_drive_controller                                                         â”‚
â”‚          â”‚                                                                      â”‚
â”‚          â”‚  hw_commands_[0] = 15.152 rad/s (left)                              â”‚
â”‚          â”‚  hw_commands_[1] = 15.152 rad/s (right)                             â”‚
â”‚          â–¼                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  radPerSecToRpm(hw_commands_[i])                                     â”‚     â”‚
â”‚   â”‚                                                                      â”‚     â”‚
â”‚   â”‚  RPM = rad/s Ã— 60 / (2Ï€)                                            â”‚     â”‚
â”‚   â”‚      = 15.152 Ã— 60 / 6.283                                          â”‚     â”‚
â”‚   â”‚      = 144 RPM                                                       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                                      â”‚
â”‚          â–¼                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  putMdData(PID_PNT_VEL_CMD, motor_id_, left_rpm, right_rpm)         â”‚     â”‚
â”‚   â”‚                                                                      â”‚     â”‚
â”‚   â”‚  1. íŒ¨í‚· ë²„í¼ ìƒì„±                                                   â”‚     â”‚
â”‚   â”‚  2. í—¤ë” ì„¤ì • (RMID=183, TMID=184, ID, PID=207)                     â”‚     â”‚
â”‚   â”‚  3. RPMì„ Little Endian ë°”ì´íŠ¸ë¡œ ë³€í™˜                               â”‚     â”‚
â”‚   â”‚  4. ì²´í¬ì„¬ ê³„ì‚° (~sum + 1)                                          â”‚     â”‚
â”‚   â”‚  5. serial_.write(packet, 13)                                       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                                      â”‚
â”‚          â–¼                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  TX Packet: [183][184][1][207][7][1][144][0][1][144][0][2][CHK]     â”‚     â”‚
â”‚   â”‚              â”‚    â”‚   â”‚   â”‚   â”‚  â”‚   â”‚   â”‚  â”‚   â”‚   â”‚  â”‚   â”‚       â”‚     â”‚
â”‚   â”‚              â”‚    â”‚   â”‚   â”‚   â”‚  â”‚   â””â”€leftâ”€â”˜  â”‚   â””rightâ”€â”˜  â”‚       â”‚     â”‚
â”‚   â”‚              â”‚    â”‚   â”‚   â”‚   â”‚  â””â”€enableâ”€â”˜    â””â”€enableâ”€â”˜    â”‚       â”‚     â”‚
â”‚   â”‚              â”‚    â”‚   â”‚   â”‚   â””â”€datasizeâ”€â”˜                   â”‚       â”‚     â”‚
â”‚   â”‚              â”‚    â”‚   â”‚   â””â”€PIDâ”€â”˜                            â”‚       â”‚     â”‚
â”‚   â”‚              â”‚    â”‚   â””â”€motor_idâ”€â”˜                           â”‚       â”‚     â”‚
â”‚   â”‚              â”‚    â””â”€TMIDâ”€â”˜                                   â”‚       â”‚     â”‚
â”‚   â”‚              â””â”€RMIDâ”€â”˜                                        â”‚       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. í”¼ë“œë°± ìˆ˜ì‹  (read)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            read() í•¨ìˆ˜ ì‹¤í–‰ íë¦„                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  receiveDataFromController()                                         â”‚     â”‚
â”‚   â”‚                                                                      â”‚     â”‚
â”‚   â”‚  1. serial_.available() í™•ì¸                                        â”‚     â”‚
â”‚   â”‚  2. serial_.read(buffer, size)                                      â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                                      â”‚
â”‚          â–¼                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  analyzeReceivedData() - ìƒíƒœ ë¨¸ì‹                                    â”‚     â”‚
â”‚   â”‚                                                                      â”‚     â”‚
â”‚   â”‚  Step 0: RMID/TMID í™•ì¸ (183 ë˜ëŠ” 184)                              â”‚     â”‚
â”‚   â”‚  Step 1: ëª¨í„° ID í™•ì¸ (1 ë˜ëŠ” 2)                                    â”‚     â”‚
â”‚   â”‚  Step 2: PID ì €ì¥                                                   â”‚     â”‚
â”‚   â”‚  Step 3: DataSize ì €ì¥                                              â”‚     â”‚
â”‚   â”‚  Step 4: ë°ì´í„° ë°”ì´íŠ¸ ìˆ˜ì‹                                          â”‚     â”‚
â”‚   â”‚  Step 5: ì²´í¬ì„¬ í™•ì¸ â†’ í†µê³¼ ì‹œ processReceivedData()                â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                                      â”‚
â”‚          â–¼                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  processReceivedData()                                               â”‚     â”‚
â”‚   â”‚                                                                      â”‚     â”‚
â”‚   â”‚  if (PID == PID_MAIN_DATA) {                                        â”‚     â”‚
â”‚   â”‚      motor_.left_rpm = byte2Short(data[0], data[1]);                â”‚     â”‚
â”‚   â”‚      motor_.left_position = byte2Long(data[2..5]);                  â”‚     â”‚
â”‚   â”‚      motor_.right_rpm = byte2Short(data[8], data[9]);               â”‚     â”‚
â”‚   â”‚      motor_.right_position = byte2Long(data[10..13]);               â”‚     â”‚
â”‚   â”‚  }                                                                   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                                      â”‚
â”‚          â–¼                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  ë‹¨ìœ„ ë³€í™˜ & ìƒíƒœ ì—…ë°ì´íŠ¸                                           â”‚     â”‚
â”‚   â”‚                                                                      â”‚     â”‚
â”‚   â”‚  // Position: tick â†’ radian                                         â”‚     â”‚
â”‚   â”‚  hw_positions_[0] = motor_.left_last_rad;                           â”‚     â”‚
â”‚   â”‚  hw_positions_[1] = motor_.right_last_rad;                          â”‚     â”‚
â”‚   â”‚                                                                      â”‚     â”‚
â”‚   â”‚  // Velocity: RPM â†’ rad/s                                           â”‚     â”‚
â”‚   â”‚  hw_velocities_[0] = rpmToRadPerSec(motor_.left_rpm);               â”‚     â”‚
â”‚   â”‚  hw_velocities_[1] = rpmToRadPerSec(motor_.right_rpm);              â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                                      â”‚
â”‚          â–¼                                                                      â”‚
â”‚   joint_state_broadcaster â†’ /joint_states                                       â”‚
â”‚   diff_drive_controller â†’ /odom                                                 â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ íŒŒì¼ êµ¬ì¡° & ì—­í• 

```
robot_hardware/
â”œâ”€â”€ CMakeLists.txt                    # ë¹Œë“œ ì„¤ì •
â”œâ”€â”€ package.xml                       # íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
â”œâ”€â”€ md_hardware_plugin.xml            # ros2_control í”ŒëŸ¬ê·¸ì¸ ë“±ë¡
â”œâ”€â”€ README.md                         # ì´ ë¬¸ì„œ
â”‚
â”œâ”€â”€ include/md_hardware/
â”‚   â”œâ”€â”€ md_hardware.hpp              # Hardware Interface í´ë˜ìŠ¤ ì„ ì–¸
â”‚   â”‚   â”œâ”€â”€ MDMotorHardware í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ Lifecycle ì½œë°± (on_init, on_configure, on_activate...)
â”‚   â”‚   â”œâ”€â”€ ì œì–´ ë£¨í”„ (read, write)
â”‚   â”‚   â””â”€â”€ í†µì‹  í•¨ìˆ˜ ì„ ì–¸
â”‚   â”‚
â”‚   â”œâ”€â”€ com.hpp                       # í†µì‹  í”„ë¡œí† ì½œ ìƒìˆ˜ & êµ¬ì¡°ì²´
â”‚   â”‚   â”œâ”€â”€ PID ì •ì˜ (PID_PNT_VEL_CMD, PID_MAIN_DATA...)
â”‚   â”‚   â”œâ”€â”€ Communication êµ¬ì¡°ì²´
â”‚   â”‚   â””â”€â”€ ë°”ì´íŠ¸ ë³€í™˜ ë§¤í¬ë¡œ
â”‚   â”‚
â”‚   â””â”€â”€ frbot_hardware.hpp            # 4WD í™•ì¥ìš© (ì„ íƒì )
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ md_hardware.cpp              # â˜… ë©”ì¸ êµ¬í˜„ íŒŒì¼
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ [Lifecycle]
â”‚   â”‚   â”‚   â”œâ”€â”€ on_init()            â† URDF íŒŒë¼ë¯¸í„° ë¡œë“œ
â”‚   â”‚   â”‚   â”œâ”€â”€ on_configure()       â† initSerial() í˜¸ì¶œ
â”‚   â”‚   â”‚   â”œâ”€â”€ on_activate()        â† ëª¨í„° í™œì„±í™”
â”‚   â”‚   â”‚   â””â”€â”€ on_deactivate()      â† í† í¬ OFF
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ [ì œì–´ ë£¨í”„ - 50Hz]
â”‚   â”‚   â”‚   â”œâ”€â”€ write()              â† putMdData() í˜¸ì¶œ
â”‚   â”‚   â”‚   â””â”€â”€ read()               â† receiveDataFromController()
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ [ì‹œë¦¬ì–¼ í†µì‹ ]
â”‚   â”‚   â”‚   â”œâ”€â”€ initSerial()         â† serial::Serial ì´ˆê¸°í™”
â”‚   â”‚   â”‚   â”œâ”€â”€ putMdData()          â† TX íŒ¨í‚· ìƒì„± & ì „ì†¡
â”‚   â”‚   â”‚   â”œâ”€â”€ receiveDataFromController() â† RX ë°ì´í„° ìˆ˜ì‹ 
â”‚   â”‚   â”‚   â”œâ”€â”€ analyzeReceivedData() â† íŒ¨í‚· íŒŒì‹± (ìƒíƒœ ë¨¸ì‹ )
â”‚   â”‚   â”‚   â””â”€â”€ processReceivedData() â† RPM/Position ì¶”ì¶œ
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ [ìœ í‹¸ë¦¬í‹°]
â”‚   â”‚       â”œâ”€â”€ radPerSecToRpm()     â† rad/s â†’ RPM
â”‚   â”‚       â”œâ”€â”€ rpmToRadPerSec()     â† RPM â†’ rad/s
â”‚   â”‚       â”œâ”€â”€ short2Byte()         â† int16 â†’ 2 bytes
â”‚   â”‚       â””â”€â”€ byte2Short/Long()    â† bytes â†’ int16/32
â”‚   â”‚
â”‚   â””â”€â”€ md_4wd_hardware.cpp          # 4WD ë²„ì „ (ì„ íƒì )
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ md_controllers.yaml          # ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ controller_manager (50Hz)
â”‚   â”‚   â”œâ”€â”€ diff_drive_controller
â”‚   â”‚   â”‚   â”œâ”€â”€ wheel_separation: 0.16
â”‚   â”‚   â”‚   â”œâ”€â”€ wheel_radius: 0.033
â”‚   â”‚   â”‚   â””â”€â”€ use_stamped_vel: false
â”‚   â”‚   â””â”€â”€ joint_state_broadcaster
â”‚   â”‚
â”‚   â””â”€â”€ md_hardware.yaml             # í•˜ë“œì›¨ì–´ íŒŒë¼ë¯¸í„° (ì„ íƒì )
â”‚
â”œâ”€â”€ urdf/
â”‚   â”œâ”€â”€ md_robot.urdf.xacro          # ë¡œë´‡ URDF
â”‚   â””â”€â”€ md_ros2_control.urdf.xacro   # ros2_control ì„¤ì •
â”‚       â””â”€â”€ <ros2_control name="md_motor_system">
â”‚           â”œâ”€â”€ <plugin>md_hardware/MDMotorHardware</plugin>
â”‚           â”œâ”€â”€ <param name="port">/dev/ttyUSB0</param>
â”‚           â”œâ”€â”€ <param name="baudrate">19200</param>
â”‚           â””â”€â”€ <joint name="left/right_wheel_joint">
â”‚
â””â”€â”€ launch/
    â””â”€â”€ md_hardware_test.launch.py   # í…ŒìŠ¤íŠ¸ ëŸ°ì¹˜ íŒŒì¼
```

---

## ğŸ”— com.cpp (ì›ë³¸) â†’ md_hardware.cpp ë§¤í•‘

| ì›ë³¸ í•¨ìˆ˜ (com.cpp) | ìƒˆ í•¨ìˆ˜ (md_hardware.cpp) | ì„¤ëª… |
|---------------------|---------------------------|------|
| `InitSerial()` | `initSerial()` | ì‹œë¦¬ì–¼ í¬íŠ¸ ì´ˆê¸°í™” |
| `PutMdData()` | `putMdData()` | ëª…ë ¹ íŒ¨í‚· ì „ì†¡ |
| `ReceiveDataFromController()` | `receiveDataFromController()` | ì‹œë¦¬ì–¼ ë°ì´í„° ìˆ˜ì‹  |
| `AnalyzeReceivedData()` | `analyzeReceivedData()` | íŒ¨í‚· íŒŒì‹± (ìƒíƒœ ë¨¸ì‹ ) |
| `MdReceiveProc()` | `processReceivedData()` | ë°ì´í„° ì²˜ë¦¬ (RPM, Position) |
| `Short2Byte()` | `short2Byte()` | int16 â†’ ë°”ì´íŠ¸ ë³€í™˜ |
| `Byte2Short()` | `byte2Short()` | ë°”ì´íŠ¸ â†’ int16 ë³€í™˜ |
| `Byte2LInt()` | `byte2Long()` | ë°”ì´íŠ¸ â†’ int32 ë³€í™˜ |

---

## ğŸš€ ì‚¬ìš©ë²•

### 1. ë¹Œë“œ

```bash
cd ~/frbot_ws
colcon build --packages-select robot_hardware
source install/setup.bash
```

### 2. ì‹¤í–‰

```bash
# í•˜ë“œì›¨ì–´ ì¸í„°í˜ì´ìŠ¤ ì‹¤í–‰
ros2 launch robot_hardware md_hardware_test.launch.py
```

### 3. Teleop ì œì–´

```bash
# ìƒˆ í„°ë¯¸ë„ì—ì„œ
ros2 run teleop_twist_keyboard teleop_twist_keyboard \
    --ros-args --remap cmd_vel:=/diff_drive_controller/cmd_vel_unstamped
```

### 4. í† í”½ í™•ì¸

```bash
# í† í”½ ëª©ë¡
ros2 topic list

# ì¡°ì¸íŠ¸ ìƒíƒœ í™•ì¸
ros2 topic echo /joint_states

# ì˜¤ë„ë©”íŠ¸ë¦¬ í™•ì¸
ros2 topic echo /diff_drive_controller/odom
```

---

## âš™ï¸ ì£¼ìš” íŒŒë¼ë¯¸í„°

### URDF íŒŒë¼ë¯¸í„° (md_ros2_control.urdf.xacro)

| íŒŒë¼ë¯¸í„° | ê¸°ë³¸ê°’ | ì„¤ëª… |
|----------|--------|------|
| `port` | `/dev/ttyUSB0` | ì‹œë¦¬ì–¼ í¬íŠ¸ |
| `baudrate` | `19200` | í†µì‹  ì†ë„ |
| `motor_id` | `1` | ëª¨í„° ë“œë¼ì´ë²„ ID |
| `id_mdt` | `183` | ëª¨í„° ë“œë¼ì´ë²„ ì‹ë³„ì |
| `id_mdui` | `184` | PC ì‹ë³„ì |
| `gear_ratio` | `15` | ê¸°ì–´ë¹„ |
| `poles` | `10` | ëª¨í„° ê·¹ ìˆ˜ |

### ì»¨íŠ¸ë¡¤ëŸ¬ íŒŒë¼ë¯¸í„° (md_controllers.yaml)

| íŒŒë¼ë¯¸í„° | ê¸°ë³¸ê°’ | ì„¤ëª… |
|----------|--------|------|
| `update_rate` | `50` | ì œì–´ ì£¼ê¸° (Hz) |
| `wheel_separation` | `0.16` | ë°”í€´ ê°„ê²© (m) |
| `wheel_radius` | `0.033` | ë°”í€´ ë°˜ê²½ (m) |
| `use_stamped_vel` | `false` | Twist ë©”ì‹œì§€ íƒ€ì… |

---

## ğŸ› ë””ë²„ê¹…

### ì‹œë¦¬ì–¼ í¬íŠ¸ ê¶Œí•œ

```bash
sudo chmod 666 /dev/ttyUSB0
# ë˜ëŠ”
sudo usermod -aG dialout $USER
```

### ë¡œê·¸ ë ˆë²¨ ë³€ê²½

```bash
ros2 run ros2_control_node ros2_control_node \
    --ros-args --log-level debug
```

### íŒ¨í‚· ëª¨ë‹ˆí„°ë§

```bash
# ì‹œë¦¬ì–¼ ë°ì´í„° í™•ì¸ (hexdump)
sudo cat /dev/ttyUSB0 | xxd
```

---

## ğŸ“‹ ì²´í¬ì„¬ ê³„ì‚°

```cpp
// ì²´í¬ì„¬ = ~(ëª¨ë“  ë°”ì´íŠ¸ í•©) + 1 (2ì˜ ë³´ìˆ˜)
uint8_t checksum = 0;
for (int i = 0; i < packet_size - 1; i++) {
    checksum += packet[i];
}
packet[packet_size - 1] = ~checksum + 1;

// ê²€ì¦: ëª¨ë“  ë°”ì´íŠ¸ í•©ì´ 0ì´ë©´ ìœ íš¨
uint8_t verify = 0;
for (int i = 0; i < packet_size; i++) {
    verify += packet[i];
}
// verify == 0 â†’ ìœ íš¨í•œ íŒ¨í‚·
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

| ë¬¸ì œ | ì›ì¸ | í•´ê²° |
|------|------|------|
| ëª¨í„° ì•ˆ ì›€ì§ì„ | íŒ¨í‚· í˜•ì‹ ë¶ˆì¼ì¹˜ | DataSize=7, 13ë°”ì´íŠ¸ íŒ¨í‚· í™•ì¸ |
| ì‹œë¦¬ì–¼ ì—´ê¸° ì‹¤íŒ¨ | ê¶Œí•œ ë¬¸ì œ | `chmod 666 /dev/ttyUSB0` |
| ì²´í¬ì„¬ ì˜¤ë¥˜ | ë°”ì´íŠ¸ ìˆœì„œ | Little Endian í™•ì¸ |
| í† í”½ ì—†ìŒ | ì»¨íŠ¸ë¡¤ëŸ¬ ë¯¸ë¡œë“œ | spawner ë¡œê·¸ í™•ì¸ |

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [ros2_control Documentation](https://control.ros.org/)
- [MD Motor Driver Manual](https://www.md.co.kr/)
- [diff_drive_controller](https://github.com/ros-controls/ros2_controllers)
|------|------|--------------|
| `md_4wd_hardware.yaml` | í•˜ë“œì›¨ì–´ ì„¤ì • | ì‹œë¦¬ì–¼ í¬íŠ¸, ë“œë¼ì´ë²„ ID, íœ  í¬ê¸°, ê¸°ì–´ë¹„ |
| `md_4wd_controllers.yaml` | ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì • | ì†ë„ ì œí•œ, ì˜¤ë„ë©”íŠ¸ë¦¬, TF í”„ë ˆì„ |

### URDF

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `md_4wd_robot.urdf.xacro` | 4ë¥œ ë¡œë´‡ ëª¨ë¸ + ros2_control ì„¤ì • |

---

## ğŸš€ ì‚¬ìš©ë²•

### 4WD ì‹¤í–‰

```bash
# ê¸°ë³¸ ì‹¤í–‰
ros2 launch robot_hardware md_4wd_test.launch.py

# í¬íŠ¸ ë³€ê²½
ros2 launch robot_hardware md_4wd_test.launch.py port:=/dev/ttyUSB1

# íŒŒë¼ë¯¸í„° ì˜¤ë²„ë¼ì´ë“œ
ros2 launch robot_hardware md_4wd_test.launch.py wheel_radius:=0.06 wheel_separation:=0.35
```

### ì†ë„ ëª…ë ¹ ì „ì†¡

```bash
# ì „ì§„ (use_stamped_vel: false ì„¤ì • ì‹œ)
ros2 topic pub /diff_drive_controller/cmd_vel_unstamped geometry_msgs/msg/Twist "{linear: {x: 0.2}, angular: {z: 0.0}}"

# íšŒì „
ros2 topic pub /diff_drive_controller/cmd_vel_unstamped geometry_msgs/msg/Twist "{linear: {x: 0.0}, angular: {z: 0.5}}"
```

### ìƒíƒœ í™•ì¸

```bash
# ì¡°ì¸íŠ¸ ìƒíƒœ
ros2 topic echo /joint_states

# ì˜¤ë„ë©”íŠ¸ë¦¬
ros2 topic echo /diff_drive_controller/odom

# ì»¨íŠ¸ë¡¤ëŸ¬ ìƒíƒœ
ros2 control list_controllers
```

---

## âš™ï¸ íŒŒë¼ë¯¸í„° ìˆ˜ì •

### ìì£¼ ë³€ê²½í•˜ëŠ” íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | íŒŒì¼ | ì„¤ëª… |
|----------|------|------|
| `port` | `md_4wd_hardware.yaml` | ì‹œë¦¬ì–¼ í¬íŠ¸ |
| `front_driver_id` | `md_4wd_hardware.yaml` | ì „ë°© ë“œë¼ì´ë²„ ID |
| `rear_driver_id` | `md_4wd_hardware.yaml` | í›„ë°© ë“œë¼ì´ë²„ ID |
| `wheel_radius` | ë‘˜ ë‹¤ | íœ  ë°˜ì§€ë¦„ (m) |
| `wheel_separation` | ë‘˜ ë‹¤ | ì¢Œìš° íœ  ê°„ê²© (m) |
| `gear_ratio` | `md_4wd_hardware.yaml` | ê¸°ì–´ë¹„ |
| `poles` | `md_4wd_hardware.yaml` | ëª¨í„° ê·¹ ìˆ˜ |
| `max_velocity` | `md_4wd_controllers.yaml` | ìµœëŒ€ ì†ë„ ì œí•œ |

### âš ï¸ ì¤‘ìš”

`wheel_radius`ì™€ `wheel_separation`ì€ **ë‘ íŒŒì¼ ëª¨ë‘** ë™ì¼í•˜ê²Œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:
- `config/md_4wd_hardware.yaml` (ì—”ì½”ë” ê³„ì‚°ìš©)
- `config/md_4wd_controllers.yaml` (ì˜¤ë„ë©”íŠ¸ë¦¬ ê³„ì‚°ìš©)

---

## ğŸ”Œ í•˜ë“œì›¨ì–´ ì—°ê²°

### 4WD ëª¨í„° ë“œë¼ì´ë²„ ë§¤í•‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RS-485 Bus (Single Port)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Front Driver (ID=1)   â”‚  â”‚   Rear Driver (ID=2)    â”‚  â”‚
â”‚  â”‚  CH1: Front Left (FL)   â”‚  â”‚  CH1: Rear Left (RL)    â”‚  â”‚
â”‚  â”‚  CH2: Front Right (FR)  â”‚  â”‚  CH2: Rear Right (RR)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‹œë¦¬ì–¼ í¬íŠ¸ ê¶Œí•œ

```bash
# dialout ê·¸ë£¹ ì¶”ê°€ (ìµœì´ˆ 1íšŒ)
sudo usermod -aG dialout $USER
# ì¬ë¡œê·¸ì¸ í•„ìš”

# ê¶Œí•œ í™•ì¸
groups | grep dialout
```

---

## ğŸ› ë¬¸ì œ í•´ê²°

### ì‹œë¦¬ì–¼ í¬íŠ¸ ì—ëŸ¬

```
IOException: No such file or directory
```

**í•´ê²°:**
1. USB-RS485 ë³€í™˜ê¸° ì—°ê²° í™•ì¸: `ls /dev/ttyUSB*`
2. í¬íŠ¸ ë³€ê²½: `port:=/dev/ttyUSB0`
3. ê¶Œí•œ í™•ì¸: `sudo chmod 666 /dev/ttyUSB0`

### ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œë“œ ì‹¤íŒ¨

```
Could not find controller 'diff_drive_controller'
```

**í•´ê²°:**
```bash
sudo apt install ros-humble-diff-drive-controller
```

### íœ ì´ ë°˜ëŒ€ë¡œ íšŒì „

**í•´ê²°:**
- ë“œë¼ì´ë²„ì˜ ì±„ë„ ë°°ì„  êµì²´
- ë˜ëŠ” `gear_ratio`ë¥¼ ìŒìˆ˜ë¡œ ì„¤ì •

---

## ğŸ“ ë¹Œë“œ

```bash
cd ~/frbot_ws
colcon build --packages-select robot_hardware --symlink-install
source install/setup.bash
```

---

## ğŸ“š ì°¸ê³ 

- [ros2_control ë¬¸ì„œ](https://control.ros.org/)
- [diff_drive_controller](https://control.ros.org/humble/doc/ros2_controllers/diff_drive_controller/doc/userdoc.html)
- MD ëª¨í„° ë“œë¼ì´ë²„ ë§¤ë‰´ì–¼

---

## ğŸ“¡ í”¼ë“œë°± ë°ì´í„° ìˆ˜ì‹  ìƒì„¸

### í†µì‹  íë¦„ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         í”¼ë“œë°± ë°ì´í„° ìˆ˜ì‹  ì „ì²´ íë¦„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   [1] write() ì—ì„œ ëª…ë ¹ ì „ì†¡ ì‹œ REQUEST í”Œë˜ê·¸ ì„¤ì •                             â”‚
â”‚       â””â”€â†’ packet[11] = REQUEST_PNT_MAIN_DATA (2)                               â”‚
â”‚           "ë°ì´í„° ë³´ë‚´ì¤˜!" ë¼ê³  ìš”ì²­                                            â”‚
â”‚                                                                                 â”‚
â”‚   [2] ëª¨í„° ë“œë¼ì´ë²„ê°€ PID_MAIN_DATA (193) íŒ¨í‚·ìœ¼ë¡œ ì‘ë‹µ                         â”‚
â”‚       â””â”€â†’ RPM, Position, Current ë°ì´í„° í¬í•¨                                   â”‚
â”‚                                                                                 â”‚
â”‚   [3] read() ì—ì„œ ìˆ˜ì‹  & íŒŒì‹±                                                   â”‚
â”‚       â””â”€â†’ receiveDataFromController()                                          â”‚
â”‚       â””â”€â†’ analyzeReceivedData()                                                â”‚
â”‚       â””â”€â†’ processReceivedData()                                                â”‚
â”‚                                                                                 â”‚
â”‚   [4] ros2_controlì´ í† í”½ìœ¼ë¡œ ë°œí–‰                                              â”‚
â”‚       â””â”€â†’ /joint_states (position, velocity)                                   â”‚
â”‚       â””â”€â†’ /diff_drive_controller/odom                                          â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìˆ˜ì‹  íŒ¨í‚· êµ¬ì¡° (PID_MAIN_DATA = 193)

```
ëª¨í„° ë“œë¼ì´ë²„ â†’ PC íŒ¨í‚· (ì•½ 22ë°”ì´íŠ¸):

â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  0   â”‚  1   â”‚  2   â”‚  3   â”‚  4   â”‚  5  6  7  8  9  10 11 12 13 14 15 16 17 ... â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RMID â”‚ TMID â”‚  ID  â”‚ PID  â”‚ Size â”‚              DATA (16+ bytes)                â”‚
â”‚ 184  â”‚ 183  â”‚  1   â”‚ 193  â”‚  16  â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATA ì˜ì—­ ìƒì„¸ (Byte 5ë¶€í„°):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Left Motor Data                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Byte 5  â”‚ Byte 6  â”‚ Byte 7  â”‚ Byte 8  â”‚ Byte 9  â”‚ Byte 10 â”‚ Byte 11 â”‚ Byte 12 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RPM_L   â”‚ RPM_H   â”‚ POS_0   â”‚ POS_1   â”‚ POS_2   â”‚ POS_3   â”‚ CURR_L  â”‚ CURR_H  â”‚
â”‚ (Low)   â”‚ (High)  â”‚ (LSB)   â”‚         â”‚         â”‚ (MSB)   â”‚ (Low)   â”‚ (High)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     int16_t                    int32_t                       int16_t
     Left RPM               Left Position                  Left Current

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Right Motor Data                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Byte 13 â”‚ Byte 14 â”‚ Byte 15 â”‚ Byte 16 â”‚ Byte 17 â”‚ Byte 18 â”‚ Byte 19 â”‚ Byte 20 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RPM_L   â”‚ RPM_H   â”‚ POS_0   â”‚ POS_1   â”‚ POS_2   â”‚ POS_3   â”‚ CURR_L  â”‚ CURR_H  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì½”ë“œì—ì„œì˜ ë°ì´í„° ì¶”ì¶œ

```cpp
// md_hardware.cpp - processReceivedData()

void MDMotorHardware::processReceivedData()
{
    uint8_t pid = comm_.recv_buf[3];  // PID ìœ„ì¹˜

    if (pid == PID_MAIN_DATA)  // 193
    {
        // ë°ì´í„°ëŠ” recv_buf[5]ë¶€í„° ì‹œì‘
        uint8_t* data = &comm_.recv_buf[5];

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ì™¼ìª½ ëª¨í„° ë°ì´í„° ì¶”ì¶œ
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        motor_.left_rpm = byte2Short(data[0], data[1]);
        //                           â””â”€Lowâ”€â”˜  â””â”€Highâ”€â”˜
        // RPM = data[0] | (data[1] << 8)
        
        motor_.left_position = byte2Long(data[2], data[3], data[4], data[5]);
        //                              â””â”€LSBâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€MSBâ”€â”˜
        // Position = data[2] | (data[3]<<8) | (data[4]<<16) | (data[5]<<24)

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ì˜¤ë¥¸ìª½ ëª¨í„° ë°ì´í„° ì¶”ì¶œ (offset +8)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        motor_.right_rpm = byte2Short(data[8], data[9]);
        motor_.right_position = byte2Long(data[10], data[11], data[12], data[13]);
    }
}
```

---

## ğŸ“ ë‹¨ìœ„ ë³€í™˜ ìˆ˜ì‹

### 1. RPM â†’ rad/s (ê°ì†ë„ ë³€í™˜)

ëª¨í„° ë“œë¼ì´ë²„ì—ì„œ ë°›ì€ RPMì„ ros2_controlì´ ì‚¬ìš©í•˜ëŠ” rad/së¡œ ë³€í™˜:

$$\omega_{rad/s} = RPM \times \frac{2\pi}{60}$$

```cpp
// md_hardware.cpp
double MDMotorHardware::rpmToRadPerSec(int16_t rpm)
{
    return rpm * (2.0 * M_PI) / 60.0;
}

// ì˜ˆì‹œ: 144 RPM â†’ ?
// Ï‰ = 144 Ã— (2Ï€ / 60) = 144 Ã— 0.1047 = 15.08 rad/s
```

### 2. Position (Tick) â†’ Radian (íšŒì „ê° ë³€í™˜)

Hall ì„¼ì„œ í‹±ì„ ë¼ë””ì•ˆìœ¼ë¡œ ë³€í™˜:

$$\theta_{rad} = tick \times \frac{2\pi}{PPR}$$

ì—¬ê¸°ì„œ **PPR (Pulses Per Revolution)**:

$$PPR = poles \times 3 \times gear\_ratio$$

- `poles` = ëª¨í„° ê·¹ ìˆ˜ (ê¸°ë³¸ê°’: 10)
- `3` = Hall ì„¼ì„œ 3ìƒ (U, V, W)
- `gear_ratio` = ê¸°ì–´ë¹„ (ê¸°ë³¸ê°’: 15)

```cpp
// md_hardware.cpp - on_init()

// PPR ê³„ì‚°
ppr_ = poles_ * 3.0 * gear_ratio_;
// PPR = 10 Ã— 3 Ã— 15 = 450 pulses/revolution

// 1í‹±ë‹¹ ë¼ë””ì•ˆ
tick_to_rad_ = (2.0 * M_PI) / ppr_;
// tick_to_rad = 2Ï€ / 450 = 0.01396 rad/tick
```

### 3. ëˆ„ì  ìœ„ì¹˜ ê³„ì‚° (Incremental)

ì—”ì½”ë”ëŠ” **ëˆ„ì  ì¹´ìš´í„°**ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ, ì´ì „ ê°’ê³¼ì˜ ì°¨ì´ë¡œ ì´ë™ëŸ‰ ê³„ì‚°:

$$\Delta\theta = (tick_{current} - tick_{previous}) \times tick\_to\_rad$$

$$\theta_{total} = \theta_{total} + \Delta\theta$$

```cpp
// md_hardware.cpp - read()

// ì™¼ìª½ ë°”í€´ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
int32_t left_diff_tick = motor_.left_position - motor_.left_last_tick;
motor_.left_last_rad += left_diff_tick * tick_to_rad_;
motor_.left_last_tick = motor_.left_position;

// hw_positions_ì— ì €ì¥ (ros2_controlì´ ì½ì–´ê°)
hw_positions_[0] = motor_.left_last_rad;
```

---

## ğŸ“Š í† í”½ ë°œí–‰ êµ¬ì¡°

### /joint_states í† í”½

`joint_state_broadcaster`ê°€ `hw_positions_[]`ì™€ `hw_velocities_[]`ë¥¼ ì½ì–´ì„œ ë°œí–‰:

```yaml
# ros2 topic echo /joint_states

header:
  stamp:
    sec: 1732711234
    nanosec: 123456789
  frame_id: ''
name:
  - left_wheel_joint
  - right_wheel_joint
position:
  - 12.566     # ì™¼ìª½ ë°”í€´ ëˆ„ì  íšŒì „ê° (rad) â† hw_positions_[0]
  - 12.345     # ì˜¤ë¥¸ìª½ ë°”í€´ ëˆ„ì  íšŒì „ê° (rad) â† hw_positions_[1]
velocity:
  - 15.08      # ì™¼ìª½ ë°”í€´ ê°ì†ë„ (rad/s) â† hw_velocities_[0]
  - 15.08      # ì˜¤ë¥¸ìª½ ë°”í€´ ê°ì†ë„ (rad/s) â† hw_velocities_[1]
effort: []
```

### /diff_drive_controller/odom í† í”½

`diff_drive_controller`ê°€ ë°”í€´ ì†ë„ë¡œë¶€í„° ë¡œë´‡ ì˜¤ë„ë©”íŠ¸ë¦¬ ê³„ì‚°:

$$v_{robot} = \frac{(\omega_L + \omega_R)}{2} \times wheel\_radius$$

$$\omega_{robot} = \frac{(\omega_R - \omega_L)}{wheel\_separation} \times wheel\_radius$$

```yaml
# ros2 topic echo /diff_drive_controller/odom

header:
  frame_id: odom
child_frame_id: base_link
pose:
  pose:
    position:
      x: 1.234    # ë¡œë´‡ X ìœ„ì¹˜ (m)
      y: 0.567    # ë¡œë´‡ Y ìœ„ì¹˜ (m)
      z: 0.0
    orientation:
      # quaternion (íšŒì „)
twist:
  twist:
    linear:
      x: 0.5      # ì„ ì†ë„ (m/s)
    angular:
      z: 0.1      # ê°ì†ë„ (rad/s)
```

---

## ğŸ”„ ì „ì²´ ë°ì´í„° íë¦„ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              50Hz Control Loop                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     TX Packet (13 bytes)      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   write()   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   MD Motor Driver       â”‚     â”‚
â”‚  â”‚             â”‚   [183][184][1][207][7]...    â”‚                         â”‚     â”‚
â”‚  â”‚ RPM ëª…ë ¹ +  â”‚   + REQUEST=2 (í”¼ë“œë°± ìš”ì²­)   â”‚  Hall ì„¼ì„œë¡œ            â”‚     â”‚
â”‚  â”‚ í”¼ë“œë°± ìš”ì²­ â”‚                               â”‚  RPM, Position ì¸¡ì •     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                            â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     RX Packet (22 bytes)                  â”‚                    â”‚
â”‚  â”‚   read()    â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚  â”‚             â”‚   [184][183][1][193][16][RPM_L][RPM_H][POS...]                 â”‚
â”‚  â”‚ ë°ì´í„° íŒŒì‹± â”‚                                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                                â”‚
â”‚         â”‚                                                                       â”‚
â”‚         â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                         ë‹¨ìœ„ ë³€í™˜                                     â”‚      â”‚
â”‚  â”‚                                                                       â”‚      â”‚
â”‚  â”‚  RPM â†’ rad/s:     Ï‰ = RPM Ã— (2Ï€/60)                                  â”‚      â”‚
â”‚  â”‚  Tick â†’ rad:      Î¸ = Î”tick Ã— (2Ï€/PPR)                               â”‚      â”‚
â”‚  â”‚                                                                       â”‚      â”‚
â”‚  â”‚  hw_velocities_[0] = rpmToRadPerSec(left_rpm)   â†’ 15.08 rad/s       â”‚      â”‚
â”‚  â”‚  hw_velocities_[1] = rpmToRadPerSec(right_rpm)  â†’ 15.08 rad/s       â”‚      â”‚
â”‚  â”‚  hw_positions_[0] += left_diff_tick Ã— tick_to_rad â†’ ëˆ„ì  radian     â”‚      â”‚
â”‚  â”‚  hw_positions_[1] += right_diff_tick Ã— tick_to_rad                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                                                                       â”‚
â”‚         â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                    ros2_control í† í”½ ë°œí–‰                             â”‚      â”‚
â”‚  â”‚                                                                       â”‚      â”‚
â”‚  â”‚  joint_state_broadcaster â†’ /joint_states                             â”‚      â”‚
â”‚  â”‚    â€¢ position: [12.566, 12.345] rad                                  â”‚      â”‚
â”‚  â”‚    â€¢ velocity: [15.08, 15.08] rad/s                                  â”‚      â”‚
â”‚  â”‚                                                                       â”‚      â”‚
â”‚  â”‚  diff_drive_controller â†’ /diff_drive_controller/odom                 â”‚      â”‚
â”‚  â”‚    â€¢ pose.position: x, y (m)                                         â”‚      â”‚
â”‚  â”‚    â€¢ twist.linear.x: 0.5 m/s                                         â”‚      â”‚
â”‚  â”‚    â€¢ twist.angular.z: 0.1 rad/s                                      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§® ìˆ˜ì‹ ìš”ì•½ í‘œ

| ë³€í™˜ | ìˆ˜ì‹ | ì˜ˆì‹œ |
|------|------|------|
| RPM â†’ rad/s | $\omega = RPM \times \frac{2\pi}{60}$ | 144 RPM â†’ 15.08 rad/s |
| Tick â†’ rad | $\theta = tick \times \frac{2\pi}{PPR}$ | 450 tick â†’ 2Ï€ rad (1íšŒì „) |
| PPR ê³„ì‚° | $PPR = poles \times 3 \times gear\_ratio$ | 10 Ã— 3 Ã— 15 = 450 |
| ë¡œë´‡ ì„ ì†ë„ | $v = \frac{(\omega_L + \omega_R)}{2} \times r$ | ë°”í€´ í‰ê·  Ã— ë°˜ì§€ë¦„ |
| ë¡œë´‡ ê°ì†ë„ | $\omega = \frac{(\omega_R - \omega_L)}{L} \times r$ | ë°”í€´ ì°¨ì´ / ë°”í€´ê°„ê²© |

### í† í”½ í™•ì¸ ëª…ë ¹ì–´

```bash
# ì¡°ì¸íŠ¸ ìƒíƒœ (position, velocity)
ros2 topic echo /joint_states

# ì˜¤ë„ë©”íŠ¸ë¦¬
ros2 topic echo /diff_drive_controller/odom

# í† í”½ ì£¼ê¸° í™•ì¸
ros2 topic hz /joint_states
```
